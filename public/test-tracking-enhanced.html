<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Tracking Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .product-card {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Enhanced PriceHunt Tracking Test</h1>
        
        <div id="status" class="status info">
            <strong>Status:</strong> <span id="tracking-status">Initializing...</span>
        </div>
        
        <div class="product-card">
            <h2>Test Product</h2>
            <p><strong>Price:</strong> €29.99</p>
            <p><strong>Description:</strong> This is a test product for tracking verification.</p>
            <button onclick="addToCart()">Add to Cart</button>
            <button onclick="trackProductView()">Track Product View</button>
        </div>
        
        <div>
            <h3>Manual Tracking Tests</h3>
            <button onclick="trackPageView()">Track Page View</button>
            <button onclick="trackBrowse()">Track Browse</button>
            <button onclick="testAddToCart()">Test Add to Cart</button>
        </div>
        
        <div>
            <h3>Tracking Log</h3>
            <div class="log" id="tracking-log"></div>
        </div>
    </div>

    <!-- Enhanced PriceHunt Tracking Script -->
    <script src="shopify-tracker-enhanced.js" 
            data-business-id="2" 
            data-affiliate-id="pavlo4" 
            data-debug="true"></script>

    <script>
        function log(message) {
            const logDiv = document.getElementById('tracking-log');
            const timestamp = new Date().toISOString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus(status, type = 'info') {
            const statusDiv = document.getElementById('status');
            const statusSpan = document.getElementById('tracking-status');
            statusSpan.textContent = status;
            statusDiv.className = `status ${type}`;
        }

        function addToCart() {
            log('Add to cart button clicked');
            
            if (window.PriceHuntTracker) {
                window.PriceHuntTracker.track('add_to_cart', {
                    product_id: 'test-product-001',
                    product_name: 'Test Product',
                    product_price: '29.99',
                    quantity: 1
                });
                log('Add to cart event sent via PriceHuntTracker');
            } else {
                log('ERROR: PriceHuntTracker not available');
            }
        }

        function trackProductView() {
            log('Track product view button clicked');
            
            if (window.PriceHuntTracker) {
                window.PriceHuntTracker.track('product_view', {
                    product_id: 'test-product-001',
                    product_name: 'Test Product',
                    product_price: '29.99'
                });
                log('Product view event sent via PriceHuntTracker');
            } else {
                log('ERROR: PriceHuntTracker not available');
            }
        }

        function trackPageView() {
            log('Track page view button clicked');
            
            if (window.PriceHuntTracker) {
                window.PriceHuntTracker.track('page_view');
                log('Page view event sent via PriceHuntTracker');
            } else {
                log('ERROR: PriceHuntTracker not available');
            }
        }

        function trackBrowse() {
            log('Track browse button clicked');
            
            if (window.PriceHuntTracker) {
                window.PriceHuntTracker.track('browse');
                log('Browse event sent via PriceHuntTracker');
            } else {
                log('ERROR: PriceHuntTracker not available');
            }
        }

        function testAddToCart() {
            log('Test add to cart with product data');
            
            if (window.PriceHuntTracker) {
                window.PriceHuntTracker.trackAddToCart({
                    title: 'Test Product',
                    price: '29.99',
                    currency: '€',
                    image: 'https://example.com/test-image.jpg',
                    url: window.location.href,
                    productId: 'test-product-001',
                    variantId: 'variant-001'
                });
                log('Add to cart event sent with product data');
            } else {
                log('ERROR: PriceHuntTracker not available');
            }
        }

        // Monitor tracker initialization
        let checkCount = 0;
        const checkTracker = setInterval(() => {
            checkCount++;
            if (window.PriceHuntTracker) {
                log('SUCCESS: PriceHuntTracker initialized successfully');
                updateStatus('Active - Tracking Events', 'success');
                clearInterval(checkTracker);
            } else if (checkCount > 20) {
                log('ERROR: PriceHuntTracker failed to initialize after 10 seconds');
                updateStatus('Failed to Initialize', 'error');
                clearInterval(checkTracker);
            }
        }, 500);

        // Override console methods to capture tracker logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            if (args[0] && args[0].includes && args[0].includes('[PriceHunt')) {
                log('LOG: ' + args.join(' '));
            }
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            if (args[0] && args[0].includes && args[0].includes('[PriceHunt')) {
                log('ERROR: ' + args.join(' '));
            }
            originalError.apply(console, args);
        };

        console.warn = function(...args) {
            if (args[0] && args[0].includes && args[0].includes('[PriceHunt')) {
                log('WARN: ' + args.join(' '));
            }
            originalWarn.apply(console, args);
        };

        // Simulate page interactions after initialization
        setTimeout(() => {
            log('Simulating automatic page interactions...');
            
            // Simulate product view
            if (window.PriceHuntTracker) {
                window.PriceHuntTracker.track('product_view', {
                    product_id: 'test-product-001',
                    product_name: 'Test Product',
                    product_price: '29.99'
                });
                log('Automatic product view event sent');
            }
        }, 2000);
    </script>
</body>
</html>
