import{j as e,v as g,t as C,D as O,F as U,i as H}from"./vendor_ui-DPKP3YLX.js";import{r as c}from"./vendor_react-Bpl_dUPQ.js";import{C as l,a as n,b as d,d as o}from"./card-C3AOPTFZ.js";import{B as f}from"./button-BVbCSO_a.js";import{B as u}from"./badge-CNTn68H-.js";import{T as _,a as z,b as R,c as h,d as q,e as x}from"./table-DcDqBArL.js";import"./index-Bm7-4qCY.js";import"./vendor_router-0FUT4RNd.js";function Y(){const[S,T]=c.useState([]),[A,N]=c.useState(!0),[a,p]=c.useState("all"),[m,P]=c.useState({totalClicks:0,totalPurchases:0,totalRevenue:0,conversionRate:0});c.useEffect(()=>{B()},[]);const B=async()=>{try{N(!0);const[t,r]=await Promise.all([fetch("/api/business/activity/clicks",{credentials:"include"}),fetch("/api/business/activity/conversions",{credentials:"include"})]),i=t.ok?await t.json():[],j=r.ok?await r.json():[],y=[...i.map(s=>({id:`click-${s.id}`,type:"click",productName:D(s.productId),productUrl:s.productId,status:"browsed",timestamp:s.timestamp,userAgent:s.userAgent,referrer:s.referrer,ip:s.ip})),...j.map(s=>({id:`purchase-${s.id}`,type:"purchase",productName:`Order ${s.orderId}`,productUrl:s.domain,status:"purchased",amount:s.amount,timestamp:s.timestamp,customerId:s.customerId}))];y.sort((s,b)=>new Date(b.timestamp).getTime()-new Date(s.timestamp).getTime()),T(y);const w=i.length,k=j.length,E=j.reduce((s,b)=>s+b.amount,0),F=w>0?k/w*100:0;P({totalClicks:w,totalPurchases:k,totalRevenue:E,conversionRate:F})}catch(t){console.error("Error fetching activity:",t)}finally{N(!1)}},D=t=>{try{const i=new URL(t).pathname.split("/").filter(Boolean);return i[i.length-1]||"Product"}catch{return"Product"}},$=t=>{switch(t){case"purchased":return e.jsx(u,{className:"bg-green-500/20 text-green-300 border-0",children:"Purchased"});case"browsed":return e.jsx(u,{className:"bg-blue-500/20 text-blue-300 border-0",children:"Browsed"});case"abandoned":return e.jsx(u,{className:"bg-red-500/20 text-red-300 border-0",children:"Abandoned"});default:return e.jsx(u,{variant:"outline",className:"text-white border-white/30",children:t})}},I=t=>{switch(t){case"click":return e.jsx(g,{className:"h-4 w-4 text-blue-600"});case"purchase":return e.jsx(C,{className:"h-4 w-4 text-green-600"});default:return e.jsx(g,{className:"h-4 w-4"})}},L=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),v=S.filter(t=>a==="clicks"?t.type==="click":a==="purchases"?t.type==="purchase":!0);return A?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((t,r)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},r))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"space-y-6 text-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(l,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-white",children:"Total Clicks"}),e.jsx(g,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.totalClicks.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Product page visits"})]})]}),e.jsxs(l,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-white",children:"Total Purchases"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.totalPurchases.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Successful conversions"})]})]}),e.jsxs(l,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-white",children:"Total Revenue"}),e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",m.totalRevenue.toLocaleString()]}),e.jsx("p",{className:"text-xs text-white/80",children:"Revenue from purchases"})]})]}),e.jsxs(l,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-white",children:"Conversion Rate"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[m.conversionRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-white/80",children:"Click to purchase ratio"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:()=>p("all"),className:`${a==="all"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"All Activity"}),e.jsx(f,{onClick:()=>p("clicks"),className:`${a==="clicks"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"Clicks Only"}),e.jsx(f,{onClick:()=>p("purchases"),className:`${a==="purchases"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"Purchases Only"})]}),e.jsxs(l,{className:"border-white/10 bg-white/5 text-white",children:[e.jsx(n,{children:e.jsx(d,{className:"text-white",children:"Recent Activity"})}),e.jsx(o,{children:v.length===0?e.jsx("div",{className:"text-center py-8 text-white/70",children:e.jsx("p",{children:"No activity found for the selected filter."})}):e.jsxs(_,{children:[e.jsx(z,{children:e.jsxs(R,{children:[e.jsx(h,{className:"text-white",children:"Type"}),e.jsx(h,{className:"text-white",children:"Product"}),e.jsx(h,{className:"text-white",children:"Status"}),e.jsx(h,{className:"text-white",children:"Amount"}),e.jsx(h,{className:"text-white",children:"Date"})]})}),e.jsx(q,{children:v.slice(0,20).map(t=>e.jsxs(R,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[I(t.type),e.jsx("span",{className:"capitalize text-white",children:t.type})]})}),e.jsx(x,{children:e.jsx("div",{className:"max-w-xs truncate",children:e.jsx("a",{href:t.productUrl,target:"_blank",rel:"noopener noreferrer",className:"text-white hover:underline",children:t.productName})})}),e.jsx(x,{children:$(t.status)}),e.jsx(x,{children:e.jsx("span",{className:"text-white",children:t.amount?`$${t.amount.toFixed(2)}`:"-"})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-white/80",children:L(t.timestamp)})]})})]},t.id))})]})})]})]})}export{Y as default};
