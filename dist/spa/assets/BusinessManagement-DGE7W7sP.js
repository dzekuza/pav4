import{j as e,s as Q,E as Z,U as q,t as K,D as X,T as Y,n as ee,u as se,v as te}from"./vendor_ui-DPKP3YLX.js";import{r as d}from"./vendor_react-Bpl_dUPQ.js";import{B as m}from"./button-BcPegbQV.js";import{C as i,a as l,b as c,d as n,c as ae}from"./card-BoaCPfwL.js";import{B as u}from"./badge-B0xV9cVX.js";import{u as re}from"./index-D26ovBZe.js";import{D as A,b as L,c as I,d as M,e as $}from"./dialog-BRbV3Abz.js";import{I as U}from"./input-BtdDvZdB.js";import{L as D}from"./label-OHnDB7wq.js";import"./vendor_router-0FUT4RNd.js";import"./index-BzUvSZV7.js";import"./index-CHPMRtFq.js";function ie({business:t,onClose:N}){const x=h=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(h),g=h=>new Intl.NumberFormat("en-US").format(h),C=t.totalRevenue*t.adminCommissionRate/100,S=t.totalPurchases>0?t.totalRevenue/t.totalPurchases:0,o=t.totalVisits>0?t.totalPurchases/t.totalVisits*100:0;return e.jsx(A,{open:!0,onOpenChange:N,children:e.jsxs(L,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(I,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),t.name," - Detailed Statistics"]}),e.jsxs($,{children:["Comprehensive analytics and performance metrics for ",t.domain]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(c,{className:"flex items-center justify-between",children:["Business Information",e.jsx(u,{variant:"outline",children:t.domain})]})}),e.jsx(n,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Website:"}),e.jsxs("a",{href:t.website,target:"_blank",rel:"noopener noreferrer",className:"ml-2 text-blue-600 hover:text-blue-800 underline flex items-center gap-1",children:[t.website,e.jsx(Z,{className:"h-3 w-3"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Commission Rate:"}),e.jsxs(u,{variant:"secondary",className:"ml-2",children:[t.adminCommissionRate,"%"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(i,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Visits"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g(t.totalVisits)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Users who visited products"})]})]}),e.jsxs(i,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Purchases"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g(t.totalPurchases)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Successful transactions"})]})]}),e.jsxs(i,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x(t.totalRevenue)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gross sales amount"})]})]}),e.jsxs(i,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Conversion Rate"}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[o.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Visits to purchases"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsx(c,{className:"text-sm font-medium",children:"Average Order Value"})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x(S)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Revenue per purchase"})]})]}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsx(c,{className:"text-sm font-medium",children:"Projected Fee"})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x(C)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.adminCommissionRate,"% of total revenue"]})]})]}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsx(c,{className:"text-sm font-medium",children:"Revenue per Visit"})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.totalVisits>0?x(t.totalRevenue/t.totalVisits):"$0.00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Average revenue per visit"})]})]})]}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsx(c,{children:"Performance Insights"})}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Conversion Efficiency:"}),e.jsx(u,{variant:o>5?"default":o>2?"secondary":"destructive",children:o>5?"Excellent":o>2?"Good":"Needs Improvement"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Revenue Performance:"}),e.jsx(u,{variant:t.totalRevenue>1e4?"default":t.totalRevenue>5e3?"secondary":"destructive",children:t.totalRevenue>1e4?"High":t.totalRevenue>5e3?"Medium":"Low"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Traffic Quality:"}),e.jsx(u,{variant:t.totalVisits>1e3?"default":t.totalVisits>500?"secondary":"destructive",children:t.totalVisits>1e3?"High":t.totalVisits>500?"Medium":"Low"})]})]})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(m,{onClick:N,children:"Close"})})]})})}function ve(){const[t,N]=d.useState([]),[x,g]=d.useState(null),[C,S]=d.useState(!0),[o,h]=d.useState(null),[O,k]=d.useState(!1),[V,w]=d.useState(!1),[j,P]=d.useState(""),[E,b]=d.useState(""),[R,z]=d.useState(!1),[T,B]=d.useState(!1),{toast:r}=re();d.useEffect(()=>{p(),v()},[]);const p=async()=>{try{const s=await fetch("/api/admin/business",{credentials:"include"});if(s.ok){const a=await s.json();N(a.businesses)}else r({title:"Error",description:"Failed to fetch businesses",variant:"destructive"})}catch(s){console.error("Error fetching businesses:",s),r({title:"Network Error",description:"Failed to connect to server",variant:"destructive"})}finally{S(!1)}},v=async()=>{try{const s=await fetch("/api/admin/business/stats",{credentials:"include"});if(s.ok){const a=await s.json();g(a.stats)}}catch(s){console.error("Error fetching stats:",s)}},H=async(s,a)=>{try{(await fetch(`/api/admin/business/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({isActive:!a})})).ok?(r({title:"Success",description:`Business ${a?"deactivated":"activated"} successfully`}),p(),v()):r({title:"Error",description:"Failed to update business status",variant:"destructive"})}catch(f){console.error("Error updating business status:",f),r({title:"Network Error",description:"Failed to connect to server",variant:"destructive"})}},W=async s=>{try{(await fetch(`/api/admin/business/${s}/verify`,{method:"POST",credentials:"include"})).ok?(r({title:"Success",description:"Business verified successfully"}),p(),v()):r({title:"Error",description:"Failed to verify business",variant:"destructive"})}catch(a){console.error("Error verifying business:",a),r({title:"Network Error",description:"Failed to connect to server",variant:"destructive"})}},_=async(s,a)=>{const f=prompt(`Enter new commission rate (current: ${a}%):`,a.toString());if(!f||isNaN(parseFloat(f)))return;const y=parseFloat(f);if(y<0||y>100){r({title:"Invalid Rate",description:"Commission rate must be between 0 and 100",variant:"destructive"});return}try{(await fetch(`/api/admin/business/${s}/commission`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({adminCommissionRate:y})})).ok?(r({title:"Success",description:`Commission rate updated to ${y}%`}),p(),v()):r({title:"Error",description:"Failed to update commission rate",variant:"destructive"})}catch(F){console.error("Error updating commission:",F),r({title:"Network Error",description:"Failed to connect to server",variant:"destructive"})}},J=async s=>{if(confirm("Are you sure you want to delete this business? This action cannot be undone."))try{(await fetch(`/api/admin/business/${s}`,{method:"DELETE",credentials:"include"})).ok?(r({title:"Success",description:"Business deleted successfully"}),p(),v()):r({title:"Error",description:"Failed to delete business",variant:"destructive"})}catch(a){console.error("Error deleting business:",a),r({title:"Network Error",description:"Failed to connect to server",variant:"destructive"})}},G=async()=>{if(!o)return;if(!j||!E){r({title:"Validation Error",description:"Please fill in all fields",variant:"destructive"});return}if(j!==E){r({title:"Password Mismatch",description:"Passwords do not match",variant:"destructive"});return}if(j.length<8){r({title:"Weak Password",description:"Password must be at least 8 characters long",variant:"destructive"});return}if(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(j)){r({title:"Weak Password",description:"Password must contain uppercase, lowercase, and number",variant:"destructive"});return}B(!0);try{const a=await fetch(`/api/admin/business/${o.id}/password`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:j})});if(a.ok)r({title:"Success",description:"Business password updated successfully"}),w(!1),P(""),b(""),h(null);else{const f=await a.json();r({title:"Error",description:f.error||"Failed to update password",variant:"destructive"})}}catch(a){console.error("Error updating password:",a),r({title:"Network Error",description:"Failed to connect to server",variant:"destructive"})}finally{B(!1)}};return C?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[...Array(3)].map((s,a)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},a))}),e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},a))})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Business Management"})}),x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(i,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium",children:"Total Businesses"})}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:x.totalBusinesses})})]}),e.jsxs(i,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium",children:"Active Businesses"})}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:x.activeBusinesses})})]}),e.jsxs(i,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium",children:"Verified Businesses"})}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:x.verifiedBusinesses})})]})]}),e.jsx("div",{className:"space-y-4",children:t.length===0?e.jsx(i,{children:e.jsx(n,{className:"p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No businesses registered yet."})})}):t.map(s=>e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[s.logo&&e.jsx("img",{src:s.logo,alt:s.name,className:"w-6 h-6 rounded"}),s.name]}),e.jsxs(ae,{children:[s.domain," • ",s.website]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.isActive?e.jsx(u,{variant:"default",children:"Active"}):e.jsx(u,{variant:"secondary",children:"Inactive"}),s.isVerified?e.jsx(u,{variant:"default",children:"Verified"}):e.jsx(u,{variant:"outline",children:"Unverified"})]})]})}),e.jsxs(n,{children:[s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[s.category&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Category:"})," ",s.category]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Admin Commission:"})," ",s.adminCommissionRate,"%"]}),s.country&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Country:"})," ",s.country]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Registered:"})," ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mt-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Visits:"})," ",s.totalVisits.toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Purchases:"})," ",s.totalPurchases.toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Revenue:"})," $",s.totalRevenue.toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Conversion Rate:"})," ",s.totalVisits>0?(s.totalPurchases/s.totalVisits*100).toFixed(1):0,"%"]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Business URL Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Domain:"}),e.jsx("span",{className:"ml-2 font-mono text-blue-600",children:s.domain})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Website:"}),e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"ml-2 text-blue-600 hover:text-blue-800 underline",children:s.website})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-4",children:[e.jsx(m,{variant:s.isActive?"destructive":"default",size:"sm",onClick:()=>H(s.id,s.isActive),className:"flex-1 sm:flex-none",children:s.isActive?"Deactivate":"Activate"}),!s.isVerified&&e.jsx(m,{variant:"outline",size:"sm",onClick:()=>W(s.id),className:"flex-1 sm:flex-none",children:"Verify"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>_(s.id,s.adminCommissionRate),className:"flex-1 sm:flex-none",children:"Set Commission"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{h(s),k(!0)},className:"flex-1 sm:flex-none",children:"View Stats"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{h(s),w(!0)},className:"flex-1 sm:flex-none",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"Update Password"]}),e.jsx(m,{variant:"destructive",size:"sm",onClick:()=>J(s.id),className:"flex-1 sm:flex-none",children:"Delete"})]})]})]},s.id))}),o&&O&&e.jsx(ie,{business:o,onClose:()=>{k(!1),h(null)}}),o&&V&&e.jsx(A,{open:V,onOpenChange:w,children:e.jsxs(L,{children:[e.jsxs(I,{children:[e.jsxs(M,{children:["Update Password for ",o.name]}),e.jsx($,{children:"Set a new password for this business account. The password must be at least 8 characters long and contain uppercase, lowercase, and a number."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"newPassword",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{id:"newPassword",type:R?"text":"password",placeholder:"Enter new password",value:j,onChange:s=>P(s.target.value)}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>z(!R),children:R?e.jsx(se,{className:"h-4 w-4"}):e.jsx(te,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(U,{id:"confirmPassword",type:"password",placeholder:"Confirm new password",value:E,onChange:s=>b(s.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>{w(!1),P(""),b(""),h(null)},children:"Cancel"}),e.jsx(m,{onClick:G,disabled:T,children:T?"Updating...":"Update Password"})]})]})]})})]})}export{ve as BusinessManagement};
