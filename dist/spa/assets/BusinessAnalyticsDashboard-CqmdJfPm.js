import{j as e,U as z,D as H,K,T as _}from"./vendor_ui-DPKP3YLX.js";import{r as v}from"./vendor_react-Bpl_dUPQ.js";import{C as d,a as o,b as h,d as x,c as p}from"./card-C3AOPTFZ.js";import{B as y}from"./button-BVbCSO_a.js";import{T as q,a as G,b as T,c as D}from"./tabs-DMdJGpTX.js";import{d as J}from"./vendor_router-0FUT4RNd.js";import"./index-Bm7-4qCY.js";import"./index-DjoQLnK1.js";import"./index-BLqSjk83.js";function re(){const{stats:M}=J(),[t,L]=v.useState({dailyVisits:[],dailyRevenue:[],topProducts:[],conversionTrends:[]}),[O,R]=v.useState(!0),[n,g]=v.useState("30d");v.useEffect(()=>{$()},[n]);const $=async()=>{try{R(!0);const[s,a,c]=await Promise.all([fetch("/api/business/activity/clicks",{credentials:"include"}),fetch("/api/business/activity/conversions",{credentials:"include"}),fetch("/api/business/auth/stats",{credentials:"include"})]),l=s.ok?await s.json():[],u=a.ok?await a.json():[],j=c.ok?await c.json():{stats:{}},m=new Map;l.forEach(r=>{const i=new Date(r.timestamp).toISOString().split("T")[0];m.set(i,(m.get(i)||0)+1)});const N=new Map;u.forEach(r=>{const i=new Date(r.timestamp).toISOString().split("T")[0];N.set(i,(N.get(i)||0)+r.amount)});const V=n==="7d"?7:n==="30d"?30:90,C=k(m,V),S=k(N,V),f=new Map,b=new Map;l.forEach(r=>{const i=E(r.productId);f.set(i,(f.get(i)||0)+1)}),u.forEach(r=>{const i=`Order ${r.orderId}`;b.set(i,(b.get(i)||0)+1)});const A=Array.from(f.entries()).map(([r,i])=>({name:r,clicks:i,purchases:b.get(r)||0})).sort((r,i)=>i.clicks-r.clicks).slice(0,5),I=C.map(r=>{var P;const i=r.visits,U=((P=S.find(F=>F.date===r.date))==null?void 0:P.revenue)||0,B=i>0?U/i*100:0;return{date:r.date,rate:B}});L({dailyVisits:C,dailyRevenue:S,topProducts:A,conversionTrends:I})}catch(s){console.error("Error fetching analytics:",s)}finally{R(!1)}},k=(s,a)=>{const c=[],l=new Date;for(let u=a-1;u>=0;u--){const j=new Date(l);j.setDate(j.getDate()-u);const m=j.toISOString().split("T")[0];c.push({date:m,visits:s.get(m)||0,revenue:s.get(m)||0})}return c},E=s=>{try{const c=new URL(s).pathname.split("/").filter(Boolean);return c[c.length-1]||"Product"}catch{return"Product"}},w=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"});return O?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((s,a)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},a))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"space-y-6 text-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-white",children:"Total Visits"}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.dailyVisits.reduce((s,a)=>s+a.visits,0).toLocaleString()}),e.jsxs("p",{className:"text-xs text-white/80",children:["Last ",n==="7d"?"7":n==="30d"?"30":"90"," days"]})]})]}),e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-white",children:"Total Revenue"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",t.dailyRevenue.reduce((s,a)=>s+a.revenue,0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-white/80",children:"Total revenue"})]})]}),e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-white",children:"Conversion Rate"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[M.conversionRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-white/80",children:"Overall rate"})]})]}),e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-white",children:"Avg Daily Visits"}),e.jsx(_,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.dailyVisits.length>0?Math.round(t.dailyVisits.reduce((s,a)=>s+a.visits,0)/t.dailyVisits.length):0}),e.jsx("p",{className:"text-xs text-white/80",children:"Average per day"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{size:"sm",onClick:()=>g("7d"),className:`${n==="7d"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"7 Days"}),e.jsx(y,{size:"sm",onClick:()=>g("30d"),className:`${n==="30d"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"30 Days"}),e.jsx(y,{size:"sm",onClick:()=>g("90d"),className:`${n==="90d"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"90 Days"})]}),e.jsxs(q,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(G,{children:[e.jsx(T,{value:"overview",children:"Overview"}),e.jsx(T,{value:"products",children:"Top Products"}),e.jsx(T,{value:"trends",children:"Trends"})]}),e.jsx(D,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{children:[e.jsx(h,{className:"text-white",children:"Daily Visits"}),e.jsxs(p,{className:"text-white/80",children:["Visitor traffic over the last ",n==="7d"?"7":n==="30d"?"30":"90"," days"]})]}),e.jsx(x,{children:t.dailyVisits.length===0||t.dailyVisits.every(s=>s.visits===0)?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-white/70",children:"No visit data available for the selected time range."})}):e.jsx("div",{className:"space-y-2",children:t.dailyVisits.slice(-7).map((s,a)=>{const c=Math.max(...t.dailyVisits.map(l=>l.visits),1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:w(s.date)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${s.visits/c*100}%`}})}),e.jsx("span",{className:"text-sm font-medium",children:s.visits})]})]},s.date)})})})]}),e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{children:[e.jsx(h,{className:"text-white",children:"Daily Revenue"}),e.jsxs(p,{className:"text-white/80",children:["Revenue generated over the last ",n==="7d"?"7":n==="30d"?"30":"90"," days"]})]}),e.jsx(x,{children:t.dailyRevenue.length===0||t.dailyRevenue.every(s=>s.revenue===0)?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-white/70",children:"No revenue data available for the selected time range."})}):e.jsx("div",{className:"space-y-2",children:t.dailyRevenue.slice(-7).map((s,a)=>{const c=Math.max(...t.dailyRevenue.map(l=>l.revenue),1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:w(s.date)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${s.revenue/c*100}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:["$",s.revenue.toLocaleString()]})]})]},s.date)})})})]})]})}),e.jsx(D,{value:"products",className:"space-y-4",children:e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{children:[e.jsx(h,{className:"text-white",children:"Top Performing Products"}),e.jsx(p,{className:"text-white/80",children:"Products with the highest engagement and conversion rates"})]}),e.jsx(x,{children:t.topProducts.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-white/70",children:"No product data available for the selected time range."})}):e.jsx("div",{className:"space-y-4",children:t.topProducts.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:a+1})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.clicks," clicks, ",s.purchases," purchases"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[s.clicks>0?(s.purchases/s.clicks*100).toFixed(1):"0.0","%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Conversion"})]})]},s.name))})})]})}),e.jsx(D,{value:"trends",className:"space-y-4",children:e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{children:[e.jsx(h,{className:"text-white",children:"Conversion Rate Trends"}),e.jsx(p,{className:"text-white/80",children:"How your conversion rate has changed over time"})]}),e.jsx(x,{children:t.conversionTrends.length===0||t.conversionTrends.every(s=>s.rate===0)?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-white/70",children:"No conversion trend data available for the selected time range."})}):e.jsx("div",{className:"space-y-2",children:t.conversionTrends.slice(-10).map((s,a)=>{const c=Math.max(...t.conversionTrends.map(l=>l.rate),1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:w(s.date)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min(s.rate/c*100,100)}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:[s.rate.toFixed(1),"%"]})]})]},s.date)})})})]})})]})]})}export{re as default};
