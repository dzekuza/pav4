import{j as e,U as q,D as G,B as K,T as Q}from"./vendor_ui-6VDHAWyR.js";import{r as j}from"./vendor_react-Bpl_dUPQ.js";import{C as d,a as o,b as h,d as x,c as p}from"./card-BAjRuEEQ.js";import{B as R}from"./button-DkTu2F27.js";import{T as W,a as X,b as S,c as V}from"./tabs-CdIcYuYS.js";import{a as Y}from"./vendor_router-0FUT4RNd.js";import"./index-C2INySnl.js";import"./index-B2MitdoE.js";import"./index-D8EubtY5.js";function oe(){const[t,O]=j.useState(null),[I,C]=j.useState(!0),[c,w]=j.useState("30d"),[N,Z]=j.useState(null),v=Y();j.useEffect(()=>{(async()=>{try{if((await fetch("/api/business/auth/check",{credentials:"include"})).status===401){v("/business-login");return}B()}catch(i){console.error("Error checking authentication:",i),v("/business-login")}})()},[v,c]);const B=async()=>{try{C(!0);const[s,i,n]=await Promise.all([fetch("/api/business/activity/clicks",{credentials:"include"}),fetch("/api/business/activity/conversions",{credentials:"include"}),fetch("/api/business/auth/stats",{credentials:"include"})]);if(!s.ok||!i.ok||!n.ok){if(s.status===401||i.status===401||n.status===401){v("/business-login");return}throw new Error("Failed to fetch analytics data. Please try again.")}const l=s.headers.get("content-type");if(!l||!l.includes("application/json"))throw new Error("Invalid response format. Please try again.");const m=await s.json(),u=await i.json(),g=n.ok?await n.json():{stats:{}},A=Array.isArray(m)?m:m.clicks||[],D=Array.isArray(u)?u:u.conversions||[],b=new Map;A.forEach(r=>{const a=new Date(r.timestamp).toISOString().split("T")[0];b.set(a,(b.get(a)||0)+1)});const y=new Map;D.forEach(r=>{const a=new Date(r.timestamp).toISOString().split("T")[0];y.set(a,(y.get(a)||0)+r.amount)});const E=c==="7d"?7:c==="30d"?30:90,M=P(b,E),L=P(y,E),k=new Map,T=new Map;A.forEach(r=>{const a=F(r.productId);k.set(a,(k.get(a)||0)+1)}),D.forEach(r=>{const a=`Order ${r.orderId}`;T.set(a,(T.get(a)||0)+1)});const U=Array.from(k.entries()).map(([r,a])=>({name:r,clicks:a,purchases:T.get(r)||0})).sort((r,a)=>a.clicks-r.clicks).slice(0,5),z=M.map(r=>{var $;const a=r.visits,H=(($=L.find(_=>_.date===r.date))==null?void 0:$.revenue)||0,J=a>0?H/a*100:0;return{date:r.date,rate:J}});O({dailyVisits:M,dailyRevenue:L,topProducts:U,conversionTrends:z})}catch(s){console.error("Error fetching analytics:",s)}finally{C(!1)}},P=(s,i)=>{const n=[],l=new Date;for(let m=i-1;m>=0;m--){const u=new Date(l);u.setDate(u.getDate()-m);const g=u.toISOString().split("T")[0];n.push({date:g,visits:s.get(g)||0,revenue:s.get(g)||0})}return n},F=s=>{try{const n=new URL(s).pathname.split("/").filter(Boolean);return n[n.length-1]||"Product"}catch{return"Product"}},f=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"});return I?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((s,i)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},i))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"space-y-6 text-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-white",children:"Total Visits"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t==null?void 0:t.dailyVisits.reduce((s,i)=>s+i.visits,0).toLocaleString()}),e.jsxs("p",{className:"text-xs text-white/80",children:["Last ",c==="7d"?"7":c==="30d"?"30":"90"," days"]})]})]}),e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-white",children:"Total Revenue"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",t==null?void 0:t.dailyRevenue.reduce((s,i)=>s+i.revenue,0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-white/80",children:"Total revenue"})]})]}),e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-white",children:"Conversion Rate"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[N==null?void 0:N.conversionRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-white/80",children:"Overall rate"})]})]}),e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-white",children:"Avg Daily Visits"}),e.jsx(Q,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(t==null?void 0:t.dailyVisits.length)>0?Math.round(t.dailyVisits.reduce((s,i)=>s+i.visits,0)/t.dailyVisits.length):0}),e.jsx("p",{className:"text-xs text-white/80",children:"Average per day"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{size:"sm",onClick:()=>w("7d"),className:`${c==="7d"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"7 Days"}),e.jsx(R,{size:"sm",onClick:()=>w("30d"),className:`${c==="30d"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"30 Days"}),e.jsx(R,{size:"sm",onClick:()=>w("90d"),className:`${c==="90d"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"90 Days"})]}),e.jsxs(W,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(X,{children:[e.jsx(S,{value:"overview",children:"Overview"}),e.jsx(S,{value:"products",children:"Top Products"}),e.jsx(S,{value:"trends",children:"Trends"})]}),e.jsx(V,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{children:[e.jsx(h,{className:"text-white",children:"Daily Visits"}),e.jsxs(p,{className:"text-white/80",children:["Visitor traffic over the last ",c==="7d"?"7":c==="30d"?"30":"90"," days"]})]}),e.jsx(x,{children:(t==null?void 0:t.dailyVisits.length)===0||t.dailyVisits.every(s=>s.visits===0)?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-white/70",children:"No visit data available for the selected time range."})}):e.jsx("div",{className:"space-y-2",children:t.dailyVisits.slice(-7).map((s,i)=>{const n=Math.max(...t.dailyVisits.map(l=>l.visits),1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:f(s.date)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${s.visits/n*100}%`}})}),e.jsx("span",{className:"text-sm font-medium",children:s.visits})]})]},s.date)})})})]}),e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{children:[e.jsx(h,{className:"text-white",children:"Daily Revenue"}),e.jsxs(p,{className:"text-white/80",children:["Revenue generated over the last ",c==="7d"?"7":c==="30d"?"30":"90"," days"]})]}),e.jsx(x,{children:(t==null?void 0:t.dailyRevenue.length)===0||t.dailyRevenue.every(s=>s.revenue===0)?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-white/70",children:"No revenue data available for the selected time range."})}):e.jsx("div",{className:"space-y-2",children:t.dailyRevenue.slice(-7).map((s,i)=>{const n=Math.max(...t.dailyRevenue.map(l=>l.revenue),1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:f(s.date)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${s.revenue/n*100}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:["$",s.revenue.toLocaleString()]})]})]},s.date)})})})]})]})}),e.jsx(V,{value:"products",className:"space-y-4",children:e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{children:[e.jsx(h,{className:"text-white",children:"Top Performing Products"}),e.jsx(p,{className:"text-white/80",children:"Products with the highest engagement and conversion rates"})]}),e.jsx(x,{children:(t==null?void 0:t.topProducts.length)===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-white/70",children:"No product data available for the selected time range."})}):e.jsx("div",{className:"space-y-4",children:t.topProducts.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:i+1})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.clicks," clicks, ",s.purchases," purchases"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[s.clicks>0?(s.purchases/s.clicks*100).toFixed(1):"0.0","%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Conversion"})]})]},s.name))})})]})}),e.jsx(V,{value:"trends",className:"space-y-4",children:e.jsxs(d,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(o,{children:[e.jsx(h,{className:"text-white",children:"Conversion Rate Trends"}),e.jsx(p,{className:"text-white/80",children:"How your conversion rate has changed over time"})]}),e.jsx(x,{children:(t==null?void 0:t.conversionTrends.length)===0||t.conversionTrends.every(s=>s.rate===0)?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-white/70",children:"No conversion trend data available for the selected time range."})}):e.jsx("div",{className:"space-y-2",children:t.conversionTrends.slice(-10).map((s,i)=>{const n=Math.max(...t.conversionTrends.map(l=>l.rate),1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:f(s.date)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min(s.rate/n*100,100)}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:[s.rate.toFixed(1),"%"]})]})]},s.date)})})})]})})]})]})}export{oe as default};
