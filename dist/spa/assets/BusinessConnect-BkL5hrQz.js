import{j as e,A as L,P as R,Y as U,G as E,E as B,R as T,f as S,c as V,C as I}from"./vendor_ui-DPKP3YLX.js";import{r as o}from"./vendor_react-Bpl_dUPQ.js";import{r as F,u as D}from"./index-D26ovBZe.js";import{B as m}from"./button-BcPegbQV.js";import{C as f,a as p,b as j,c as v,d as y}from"./card-BoaCPfwL.js";import{I as O}from"./input-BtdDvZdB.js";import{L as z}from"./label-OHnDB7wq.js";import{B as x}from"./badge-B0xV9cVX.js";import{a as G}from"./vendor_router-0FUT4RNd.js";function Z(){const h=G(),{business:H,isBusinessLoading:u,isBusiness:g}=F(),{toast:r}=D(),[c,N]=o.useState(""),[b,w]=o.useState(!1),[t,l]=o.useState([{id:"1",url:"https://example.com",domain:"example.com",status:"active",addedAt:"2024-01-15"}]);if(o.useEffect(()=>{!u&&!g&&h("/business-login")},[u,g,h]),u)return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})})});if(!g)return null;const k=async()=>{if(!c.trim()){r({title:"Error",description:"Please enter a valid URL",variant:"destructive"});return}try{if(!new URL(c).protocol.startsWith("http"))throw new Error("Invalid protocol")}catch{r({title:"Invalid URL",description:"Please enter a valid URL starting with http:// or https://",variant:"destructive"});return}w(!0);const s={id:Date.now().toString(),url:c,domain:new URL(c).hostname,status:"pending",addedAt:new Date().toISOString().split("T")[0]};l([...t,s]),N(""),w(!1),r({title:"Page Added",description:"The page has been added. Click 'Verify' to check if the tracking script is installed."})},C=async s=>{const d=t.find(a=>a.id===s);if(d){l(t.map(a=>a.id===s?{...a,verifying:!0}:a));try{const i=await(await fetch("/api/business/verify-tracking",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pageUrl:d.url})})).json();i.success?(l(t.map(n=>n.id===s?{...n,status:"active",verifying:!1}:n)),r({title:"Verification Successful!",description:"Tracking script is properly installed on your page."})):(l(t.map(n=>n.id===s?{...n,status:"error",verifying:!1}:n)),r({title:"Verification Failed",description:i.error||"Could not verify tracking script. Please check the installation.",variant:"destructive"}),i.instructions&&console.log("Installation instructions:",i.instructions))}catch(a){console.error("Verification error:",a),l(t.map(i=>i.id===s?{...i,status:"error",verifying:!1}:i)),r({title:"Verification Error",description:"Failed to verify tracking script. Please try again.",variant:"destructive"})}}},P=s=>{l(t.filter(d=>d.id!==s)),r({title:"Page Removed",description:"The page has been removed from your connected pages"})},A=s=>{switch(s){case"active":return e.jsxs(x,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Active"]});case"pending":return e.jsx(x,{variant:"secondary",children:"Pending"});case"error":return e.jsxs(x,{variant:"destructive",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Error"]});default:return e.jsx(x,{variant:"secondary",children:"Unknown"})}};return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(m,{variant:"ghost",onClick:()=>h("/business/integrate"),className:"mb-4",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Back to Integration"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Connect Pages"}),e.jsx("p",{className:"text-gray-600",children:"Add tracking to additional pages or domains"})]}),e.jsxs(f,{className:"mb-8",children:[e.jsxs(p,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Add New Page"]}),e.jsx(v,{children:"Enter the URL of the page you want to connect"})]}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{htmlFor:"page-url",children:"Page URL"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(O,{id:"page-url",type:"url",placeholder:"https://example.com",value:c,onChange:s=>N(s.target.value),className:"flex-1"}),e.jsx(m,{onClick:k,disabled:b||!c.trim(),children:b?"Adding...":"Add Page"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"• Enter the full URL including http:// or https://"}),e.jsx("p",{children:"• The page will be verified before tracking is enabled"}),e.jsx("p",{children:"• You can add multiple pages from the same domain"})]})]})})]}),e.jsxs(f,{children:[e.jsxs(p,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Connected Pages"]}),e.jsx(v,{children:"Pages that are currently connected to your business account"})]}),e.jsx(y,{children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No pages connected yet"}),e.jsx("p",{className:"text-sm",children:"Add your first page using the form above"})]}):e.jsx("div",{className:"space-y-4",children:t.map(s=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"h-4 w-4 text-gray-400"}),e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 font-medium",children:s.url})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["Domain: ",s.domain]}),e.jsxs("span",{children:["Added: ",s.addedAt]}),A(s.status)]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="pending"&&e.jsx(m,{variant:"outline",size:"sm",onClick:()=>C(s.id),disabled:s.verifying,children:s.verifying?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-1 animate-spin"}),"Verifying..."]}):"Verify"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>P(s.id),className:"text-red-600 hover:text-red-800",children:e.jsx(S,{className:"h-4 w-4"})})]})]})},s.id))})})]}),e.jsxs(f,{className:"mt-8",children:[e.jsxs(p,{children:[e.jsx(j,{children:"Integration Instructions"}),e.jsx(v,{children:"Follow these steps to complete the integration"})]}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center text-sm font-medium",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Add your pages"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Enter the URLs of the pages you want to track"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center text-sm font-medium",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Install tracking script"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Copy and paste the tracking script into your website's HTML"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center text-sm font-medium",children:"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Verify integration"}),e.jsx("p",{className:"text-sm text-gray-600",children:'Click "Verify" to check that tracking is working correctly'})]})]})]})})]})]})})}export{Z as default};
