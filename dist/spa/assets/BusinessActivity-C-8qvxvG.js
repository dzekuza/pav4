import{j as e,v as j,t as P,D as H,i as J,F as _}from"./vendor_ui-6VDHAWyR.js";import{r as d}from"./vendor_react-Bpl_dUPQ.js";import{C as x,a as h,b as m,d as u}from"./card-BAjRuEEQ.js";import{B as w}from"./button-DkTu2F27.js";import{B as f}from"./badge-CRJ5PX0Z.js";import{T as q,a as G,b as R,c as l,d as K,e as n}from"./table-CS13C2lh.js";import{S as B}from"./SearchHeader-5zoZ1kxO.js";import{r as M}from"./index-C2INySnl.js";import{a as Q}from"./vendor_router-0FUT4RNd.js";import"./index-B2MitdoE.js";import"./index-D8EubtY5.js";import"./index-B8LjdZBf.js";function le(){const{business:g}=M();Q();const[D,L]=d.useState([]),[U,k]=d.useState(!0),[r,b]=d.useState("all"),[p,I]=d.useState({totalClicks:0,totalPurchases:0,totalRevenue:0,conversionRate:0});d.useEffect(()=>{C()},[]);const C=async()=>{try{k(!0);const[s,o]=await Promise.all([fetch("/api/business/activity/clicks",{credentials:"include"}),fetch("/api/business/activity/conversions",{credentials:"include"})]),a=s.ok?await s.json():{clicks:[]},i=o.ok?await o.json():{conversions:[]},c=Array.isArray(a)?a:a.clicks||[],N=Array.isArray(i)?i:i.conversions||[],T=[...c.map(t=>({id:`click-${t.id}`,type:"click",productName:$(t.productUrl),productUrl:t.productUrl,status:"browsed",timestamp:t.timestamp,userAgent:t.userAgent,referrer:t.referrer,ip:t.ipAddress})),...N.map(t=>({id:`purchase-${t.id}`,type:"purchase",productName:`Order ${t.orderId}`,productUrl:t.domain,status:"purchased",amount:t.amount,timestamp:t.timestamp,customerId:t.customerId}))];T.sort((t,y)=>new Date(y.timestamp).getTime()-new Date(t.timestamp).getTime()),L(T);const v=c.length,S=N.length,F=N.reduce((t,y)=>t+y.amount,0),O=v>0?S/v*100:0;I({totalClicks:v,totalPurchases:S,totalRevenue:F,conversionRate:O})}catch(s){console.error("Error fetching activity:",s)}finally{k(!1)}},$=s=>{try{const a=new URL(s).pathname.split("/").filter(c=>c.length>0),i=a[a.length-1];return i?i.replace(/[-_]/g," ").replace(/\b\w/g,c=>c.toUpperCase()):"Product"}catch{return"Product"}},z=s=>{switch(s){case"purchased":return e.jsx(f,{variant:"default",className:"bg-green-100 text-green-800",children:"Purchased"});case"browsed":return e.jsx(f,{variant:"secondary",children:"Browsed"});case"abandoned":return e.jsx(f,{variant:"destructive",children:"Abandoned"});default:return e.jsx(f,{variant:"outline",children:s})}},E=s=>{switch(s){case"click":return e.jsx(j,{className:"h-4 w-4 text-blue-500"});case"purchase":return e.jsx(P,{className:"h-4 w-4 text-green-500"});default:return e.jsx(j,{className:"h-4 w-4"})}},A=D.filter(s=>r==="all"?!0:r==="clicks"?s.type==="click":r==="purchases"?s.type==="purchase":!0);return U?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(B,{showBackButton:!1}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[...Array(4)].map((s,o)=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},o))}),e.jsx("div",{className:"h-96 bg-gray-200 rounded"})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden text-white",children:[e.jsx("img",{src:"/pagebg.png",alt:"",className:"pointer-events-none absolute inset-0 -z-10 h-full w-full object-cover opacity-100"}),e.jsx(B,{showBackButton:!1}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"User Activity"}),e.jsxs("p",{className:"text-white/70",children:["Track user interactions and purchases for ",(g==null?void 0:g.name)||"your business"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsxs(x,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-white",children:"Total Clicks"}),e.jsx(j,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.totalClicks.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Product page visits"})]})]}),e.jsxs(x,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-white",children:"Total Purchases"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.totalPurchases.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Successful conversions"})]})]}),e.jsxs(x,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-white",children:"Total Revenue"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",p.totalRevenue.toLocaleString()]}),e.jsx("p",{className:"text-xs text-white/80",children:"Total sales revenue"})]})]}),e.jsxs(x,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-white",children:"Conversion Rate"}),e.jsx(J,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[p.conversionRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-white/80",children:"Click to purchase ratio"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{size:"sm",onClick:()=>b("all"),className:`${r==="all"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"All Activity"}),e.jsx(w,{size:"sm",onClick:()=>b("clicks"),className:`${r==="clicks"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"Clicks Only"}),e.jsx(w,{size:"sm",onClick:()=>b("purchases"),className:`${r==="purchases"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"Purchases Only"})]}),e.jsxs(w,{size:"sm",onClick:C,className:"rounded-full bg-white text-black border border-black/10 hover:bg-white/90",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Refresh"]})]}),e.jsxs(x,{className:"border-white/10 bg-white/5 text-white",children:[e.jsx(h,{children:e.jsx(m,{className:"text-white",children:"Activity Log"})}),e.jsx(u,{children:A.length===0?e.jsxs("div",{className:"text-center py-8 text-white/70",children:[e.jsx(j,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No activity found"}),e.jsx("p",{className:"text-sm text-white/70",children:"User activity will appear here once customers start browsing your products"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(q,{children:[e.jsx(G,{children:e.jsxs(R,{children:[e.jsx(l,{children:"Type"}),e.jsx(l,{children:"Product"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Amount"}),e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Details"})]})}),e.jsx(K,{children:A.map(s=>e.jsxs(R,{children:[e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[E(s.type),e.jsx("span",{className:"capitalize",children:s.type})]})}),e.jsx(n,{children:e.jsxs("div",{className:"max-w-xs truncate",children:[e.jsx("div",{className:"font-medium",children:s.productName}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:s.productUrl})]})}),e.jsx(n,{children:z(s.status)}),e.jsx(n,{children:s.amount?e.jsxs("span",{className:"font-medium text-green-600",children:["$",s.amount.toFixed(2)]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-sm",children:new Date(s.timestamp).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.timestamp).toLocaleTimeString()})]}),e.jsx(n,{children:e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.customerId&&e.jsxs("div",{children:["Customer: ",s.customerId]}),s.ip&&e.jsxs("div",{children:["IP: ",s.ip]})]})})]},s.id))})]})})})]})]})]})}export{le as default};
