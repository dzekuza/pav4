import{j as e,v as j,t as S,D as F,i as O,F as H}from"./vendor_ui-DPKP3YLX.js";import{r as o}from"./vendor_react-Bpl_dUPQ.js";import{C as x,a as h,b as m,d as u}from"./card-CUmbL-D9.js";import{B as w}from"./button-DP2dp-PV.js";import{B as f}from"./badge-Cx_qSRgY.js";import{T as _,a as q,b as A,c,d as G,e as l}from"./table-DJ6C3_7E.js";import{S as P}from"./SearchHeader-BXp9_NKE.js";import{r as J}from"./index-ZVa9_c7w.js";import{a as K}from"./vendor_router-0FUT4RNd.js";import"./index-BrMgMA-w.js";import"./index-DxE6KrYo.js";import"./index-B6HsZdxu.js";function ie(){const{business:g}=J();K();const[R,B]=o.useState([]),[I,y]=o.useState(!0),[a,b]=o.useState("all"),[p,D]=o.useState({totalClicks:0,totalPurchases:0,totalRevenue:0,conversionRate:0});o.useEffect(()=>{k()},[]);const k=async()=>{try{y(!0);const[s,n]=await Promise.all([fetch("/api/business/activity/clicks",{credentials:"include"}),fetch("/api/business/activity/conversions",{credentials:"include"})]),d=s.ok?await s.json():[],r=n.ok?await n.json():[],i=[...d.map(t=>({id:`click-${t.id}`,type:"click",productName:L(t.productId),productUrl:t.productId,status:"browsed",timestamp:t.timestamp,userAgent:t.userAgent,referrer:t.referrer,ip:t.ip})),...r.map(t=>({id:`purchase-${t.id}`,type:"purchase",productName:`Order ${t.orderId}`,productUrl:t.domain,status:"purchased",amount:t.amount,timestamp:t.timestamp,customerId:t.customerId}))];i.sort((t,v)=>new Date(v.timestamp).getTime()-new Date(t.timestamp).getTime()),B(i);const N=d.length,T=r.length,z=r.reduce((t,v)=>t+v.amount,0),E=N>0?T/N*100:0;D({totalClicks:N,totalPurchases:T,totalRevenue:z,conversionRate:E})}catch(s){console.error("Error fetching activity:",s)}finally{y(!1)}},L=s=>{try{const d=new URL(s).pathname.split("/").filter(i=>i.length>0),r=d[d.length-1];return r?r.replace(/[-_]/g," ").replace(/\b\w/g,i=>i.toUpperCase()):"Product"}catch{return"Product"}},$=s=>{switch(s){case"purchased":return e.jsx(f,{variant:"default",className:"bg-green-100 text-green-800",children:"Purchased"});case"browsed":return e.jsx(f,{variant:"secondary",children:"Browsed"});case"abandoned":return e.jsx(f,{variant:"destructive",children:"Abandoned"});default:return e.jsx(f,{variant:"outline",children:s})}},U=s=>{switch(s){case"click":return e.jsx(j,{className:"h-4 w-4 text-blue-500"});case"purchase":return e.jsx(S,{className:"h-4 w-4 text-green-500"});default:return e.jsx(j,{className:"h-4 w-4"})}},C=R.filter(s=>a==="all"?!0:a==="clicks"?s.type==="click":a==="purchases"?s.type==="purchase":!0);return I?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(P,{showBackButton:!1}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[...Array(4)].map((s,n)=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},n))}),e.jsx("div",{className:"h-96 bg-gray-200 rounded"})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden text-white",children:[e.jsx("img",{src:"/pagebg.png",alt:"",className:"pointer-events-none absolute inset-0 -z-10 h-full w-full object-cover opacity-100"}),e.jsx(P,{showBackButton:!1}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"User Activity"}),e.jsxs("p",{className:"text-white/70",children:["Track user interactions and purchases for ",(g==null?void 0:g.name)||"your business"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsxs(x,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-white",children:"Total Clicks"}),e.jsx(j,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.totalClicks.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Product page visits"})]})]}),e.jsxs(x,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-white",children:"Total Purchases"}),e.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.totalPurchases.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Successful conversions"})]})]}),e.jsxs(x,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-white",children:"Total Revenue"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",p.totalRevenue.toLocaleString()]}),e.jsx("p",{className:"text-xs text-white/80",children:"Total sales revenue"})]})]}),e.jsxs(x,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-white",children:"Conversion Rate"}),e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[p.conversionRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-white/80",children:"Click to purchase ratio"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{size:"sm",onClick:()=>b("all"),className:`${a==="all"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"All Activity"}),e.jsx(w,{size:"sm",onClick:()=>b("clicks"),className:`${a==="clicks"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"Clicks Only"}),e.jsx(w,{size:"sm",onClick:()=>b("purchases"),className:`${a==="purchases"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"Purchases Only"})]}),e.jsxs(w,{size:"sm",onClick:k,className:"rounded-full bg-white text-black border border-black/10 hover:bg-white/90",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Refresh"]})]}),e.jsxs(x,{className:"border-white/10 bg-white/5 text-white",children:[e.jsx(h,{children:e.jsx(m,{className:"text-white",children:"Activity Log"})}),e.jsx(u,{children:C.length===0?e.jsxs("div",{className:"text-center py-8 text-white/70",children:[e.jsx(j,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No activity found"}),e.jsx("p",{className:"text-sm text-white/70",children:"User activity will appear here once customers start browsing your products"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(_,{children:[e.jsx(q,{children:e.jsxs(A,{children:[e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Amount"}),e.jsx(c,{children:"Date"}),e.jsx(c,{children:"Details"})]})}),e.jsx(G,{children:C.map(s=>e.jsxs(A,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[U(s.type),e.jsx("span",{className:"capitalize",children:s.type})]})}),e.jsx(l,{children:e.jsxs("div",{className:"max-w-xs truncate",children:[e.jsx("div",{className:"font-medium",children:s.productName}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:s.productUrl})]})}),e.jsx(l,{children:$(s.status)}),e.jsx(l,{children:s.amount?e.jsxs("span",{className:"font-medium text-green-600",children:["$",s.amount.toFixed(2)]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsxs(l,{children:[e.jsx("div",{className:"text-sm",children:new Date(s.timestamp).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.timestamp).toLocaleTimeString()})]}),e.jsx(l,{children:e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.customerId&&e.jsxs("div",{children:["Customer: ",s.customerId]}),s.ip&&e.jsxs("div",{children:["IP: ",s.ip]})]})})]},s.id))})]})})})]})]})]})}export{ie as default};
