import{j as e,E as A,g as q,U as D,D as H,P as J,h as W,f as X,S as Y,L as Z,b as ee,i as se}from"./vendor_ui-DPKP3YLX.js";import{r as a}from"./vendor_react-Bpl_dUPQ.js";import{S as I}from"./SearchHeader-BQRgaaLe.js";import{C as m,a as p,b as g,d as x,c as te}from"./card-C3AOPTFZ.js";import{B as $}from"./badge-CNTn68H-.js";import{A as M,a as B}from"./alert-CdpANgE4.js";import{B as j}from"./button-BVbCSO_a.js";import{T as ae,a as ie,b as V,c as _}from"./tabs-DMdJGpTX.js";import{I as G}from"./input--XZmn13O.js";import{L as C}from"./label-09uxue2U.js";import{c as re,u as ne}from"./index-Bm7-4qCY.js";import{S as K}from"./switch-DqI08Ddr.js";import{D as le,a as ce,b as de,c as oe,d as me,e as xe}from"./dialog-C3oruSML.js";import{a as he}from"./vendor_router-0FUT4RNd.js";import"./index-DjoQLnK1.js";import"./index-BLqSjk83.js";import"./index-fqsw_NIb.js";const Q=a.forwardRef(({className:h,...c},b)=>e.jsx("textarea",{className:re("flex min-h-[120px] w-full rounded-md border border-white/10 bg-white/5 px-3 py-2 text-sm text-white placeholder:text-white/60 backdrop-blur-sm focus-visible:outline-none focus-visible:ring-0",h),ref:b,...c}));Q.displayName="Textarea";function fe({className:h=""}){const[c,b]=a.useState([]),[u,R]=a.useState(null),[T,E]=a.useState(!0),[w,S]=a.useState(""),[L,N]=a.useState(!1),[d,v]=a.useState(null),[r,n]=a.useState({name:"",url:"",description:"",isActive:!0}),{toast:f}=ne();a.useEffect(()=>{o(),U()},[]);const o=async()=>{try{const s=await fetch("/api/admin/affiliate/urls",{credentials:"include"});if(s.ok){const l=await s.json();b(l.urls)}else S("Failed to fetch affiliate URLs")}catch{S("Network error occurred")}finally{E(!1)}},U=async()=>{try{const s=await fetch("/api/admin/affiliate/stats",{credentials:"include"});if(s.ok){const l=await s.json();R(l.stats)}}catch(s){console.error("Failed to fetch affiliate stats:",s)}},F=async s=>{s.preventDefault();try{const l=d?`/api/admin/affiliate/urls/${d.id}`:"/api/admin/affiliate/urls",i=await fetch(l,{method:d?"PUT":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(r)});if(i.ok){const z=await i.json();f({title:d?"URL Updated":"URL Created",description:z.message}),N(!1),v(null),k(),o(),U()}else{const z=await i.json();f({title:"Error",description:z.error||"Failed to save affiliate URL",variant:"destructive"})}}catch{f({title:"Error",description:"Network error occurred",variant:"destructive"})}},O=async s=>{if(confirm("Are you sure you want to delete this affiliate URL?"))try{(await fetch(`/api/admin/affiliate/urls/${s}`,{method:"DELETE",credentials:"include"})).ok?(f({title:"URL Deleted",description:"Affiliate URL deleted successfully"}),o(),U()):f({title:"Error",description:"Failed to delete affiliate URL",variant:"destructive"})}catch{f({title:"Error",description:"Network error occurred",variant:"destructive"})}},P=s=>{v(s),n({name:s.name,url:s.url,description:s.description||"",isActive:s.isActive}),N(!0)},k=()=>{n({name:"",url:"",description:"",isActive:!0})},y=()=>{v(null),k(),N(!0)};return T?e.jsx("div",{className:`space-y-6 ${h}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})}):e.jsxs("div",{className:`space-y-6 ${h}`,children:[u&&e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Total URLs"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.totalUrls}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[u.activeUrls," active"]})]})]}),e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Total Clicks"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.totalClicks.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Across all URLs"})]})]}),e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Conversions"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.totalConversions.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total conversions"})]})]}),e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Revenue"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",u.totalRevenue.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total revenue"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Affiliate URLs"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your affiliate links and track performance"})]}),e.jsxs(le,{open:L,onOpenChange:N,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(j,{onClick:y,children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Add URL"]})}),e.jsxs(de,{children:[e.jsxs(oe,{children:[e.jsx(me,{children:d?"Edit Affiliate URL":"Add New Affiliate URL"}),e.jsx(xe,{children:d?"Update the affiliate URL details below.":"Create a new affiliate URL to track clicks and conversions."})]}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"name",children:"Name"}),e.jsx(G,{id:"name",value:r.name,onChange:s=>n({...r,name:s.target.value}),placeholder:"Amazon Electronics",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"url",children:"URL"}),e.jsx(G,{id:"url",type:"url",value:r.url,onChange:s=>n({...r,url:s.target.value}),placeholder:"https://amazon.com/electronics",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"description",children:"Description (Optional)"}),e.jsx(Q,{id:"description",value:r.description,onChange:s=>n({...r,description:s.target.value}),placeholder:"Electronics affiliate link for Amazon"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{id:"isActive",checked:r.isActive,onCheckedChange:s=>n({...r,isActive:s})}),e.jsx(C,{htmlFor:"isActive",children:"Active"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(j,{type:"submit",children:d?"Update":"Create"})]})]})]})]})]}),w&&e.jsx(M,{variant:"destructive",children:e.jsx(B,{children:w})}),e.jsx("div",{className:"space-y-4",children:c.length===0?e.jsx(m,{children:e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No affiliate URLs yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first affiliate URL to start tracking clicks and conversions."}),e.jsxs(j,{onClick:y,children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Add First URL"]})]})}):c.map(s=>e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.name}),s.isActive?e.jsx($,{variant:"secondary",children:"Active"}):e.jsx($,{variant:"outline",children:"Inactive"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.url}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),s.clicks.toLocaleString()," clicks"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),s.conversions.toLocaleString()," conversions"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3"}),"$",s.revenue.toFixed(2)," revenue"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>P(s),children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>window.open(s.url,"_blank"),children:e.jsx(A,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>O(s.id),children:e.jsx(X,{className:"h-4 w-4"})})]})]})})},s.id))})]})}function Te(){const h=he(),[c,b]=a.useState([]),[u,R]=a.useState(!0),[T,E]=a.useState(!0),[w,S]=a.useState(""),[L,N]=a.useState(null),[d,v]=a.useState(null),[r,n]=a.useState(!1),[f,o]=a.useState("");a.useEffect(()=>{U(),P()},[]);const U=async()=>{try{const t=await fetch("/api/auth/me",{credentials:"include"});if(t.ok){const i=await t.json();i.user&&i.user.isAdmin?(N(i.user),O()):h("/login")}else h("/login")}catch{h("/login")}finally{E(!1)}},F=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),h("/login")}catch(t){console.error("Logout error:",t)}},O=async()=>{try{const t=await fetch("/api/admin/users",{credentials:"include"});if(t.ok){const i=await t.json();b(i.users)}else S("Failed to fetch users")}catch{S("Network error occurred")}finally{R(!1)}},P=async()=>{n(!0),o("");try{const t=await fetch("/api/admin/settings/suggestion-filter",{credentials:"include"});if(t.ok){const i=await t.json();v(i.enabled)}else o("Failed to fetch filter state")}catch{o("Network error fetching filter state")}finally{n(!1)}},k=async t=>{n(!0),o("");try{(await fetch("/api/admin/settings/suggestion-filter",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({enabled:t})})).ok?v(t):o("Failed to update filter state")}catch{o("Network error updating filter state")}finally{n(!1)}};if(T||u)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(I,{}),e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]});if(!L)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(I,{}),e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsxs(M,{variant:"destructive",className:"max-w-md mx-auto",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx(B,{children:"Redirecting to admin login..."})]})})]});const y=c.length,s=c.filter(t=>t.isAdmin).length,l=c.reduce((t,i)=>t+i.searchCount,0);return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(I,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage users and monitor system activity"}),L&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Logged in as: ",L.email]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx(K,{checked:!!d,disabled:r||d===null,onCheckedChange:k,id:"suggestion-filter-toggle"}),e.jsx("label",{htmlFor:"suggestion-filter-toggle",className:"text-sm",children:"Show only suggestions from registered businesses"}),r&&e.jsx("span",{className:"text-xs ml-2",children:"Saving..."}),f&&e.jsx("span",{className:"text-xs text-red-500 ml-2",children:f})]})]}),e.jsxs(j,{variant:"outline",onClick:F,className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]}),w&&e.jsx(M,{variant:"destructive",className:"mb-6",children:e.jsx(B,{children:w})}),e.jsxs(ae,{defaultValue:"users",className:"space-y-6",children:[e.jsxs(ie,{children:[e.jsxs(V,{value:"users",className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Users"]}),e.jsxs(V,{value:"affiliate",className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Affiliate URLs"]})]}),e.jsxs(_,{value:"users",className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:y}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s," admin",s!==1?"s":""]})]})]}),e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Total Searches"}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Across all users"})]})]}),e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Avg. Searches/User"}),e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:y>0?Math.round(l/y):0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Per registered user"})]})]})]}),e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Registered Users"}),e.jsx(te,{children:"All users registered in the system"})]}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:c.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No users found"}):c.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",children:t.email}),t.isAdmin&&e.jsx($,{variant:"secondary",children:"Admin"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Joined ",new Date(t.createdAt).toLocaleDateString()," •"," ",t.searchCount," searches"]})]}),e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:["ID: ",t.id.toString().slice(0,8),"..."]})]},t.id))})})]})]}),e.jsx(_,{value:"affiliate",children:e.jsx(fe,{})})]})]})]})}export{Te as default};
