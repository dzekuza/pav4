import{j as e,c as he,R as G,v as m,t as C,D as M,F as Q,i as W}from"./vendor_ui-6VDHAWyR.js";import{r as u}from"./vendor_react-Bpl_dUPQ.js";import{C as c,a as l,b as n,d}from"./card-BAjRuEEQ.js";import{B as w}from"./button-DkTu2F27.js";import{B as g}from"./badge-CRJ5PX0Z.js";import{T as xe,a as me,b as X,c as v,d as ue,e as y}from"./table-CS13C2lh.js";import{a as we}from"./vendor_router-0FUT4RNd.js";import"./index-C2INySnl.js";function ke(){const[Y,Z]=u.useState([]),[ee,F]=u.useState(!0),[P,O]=u.useState(!1),[B,I]=u.useState(null),[o,b]=u.useState("all"),[a,te]=u.useState({totalClicks:0,totalPurchases:0,totalRevenue:0,conversionRate:0,totalAddToCart:0,totalPageViews:0,totalProductViews:0,cartToPurchaseRate:0,averageOrderValue:0,totalSessions:0}),k=we();u.useEffect(()=>{(async()=>{try{if((await fetch("/api/business/auth/check",{credentials:"include"})).status===401){k("/business/login");return}U()}catch(r){console.error("Error checking authentication:",r),k("/business/login")}})()},[k]);const U=async(s=!1)=>{try{s?O(!0):F(!0),I(null);const[r,p,_]=await Promise.all([fetch("/api/business/activity/clicks",{credentials:"include"}),fetch("/api/business/activity/conversions",{credentials:"include"}),fetch("/api/business/activity/events",{credentials:"include"})]);if(!r.ok||!p.ok||!_.ok){if(r.status===401||p.status===401||_.status===401){k("/business-login");return}throw new Error("Failed to fetch activity data. Please try again.")}const H=r.headers.get("content-type");if(!H||!H.includes("application/json"))throw new Error("Invalid response format. Please try again.");const T=await r.json(),R=await p.json(),S=await _.json(),D=Array.isArray(T)?T:T.clicks||[],A=Array.isArray(R)?R:R.conversions||[],x=Array.isArray(S)?S:S.events||[],z=[...D.map(t=>({id:`click-${t.id}`,type:"click",productName:E(t.productUrl),productUrl:t.productUrl,status:"browsed",timestamp:t.timestamp,userAgent:t.userAgent,referrer:t.referrer,ip:t.ipAddress})),...A.map(t=>({id:`conversion-${t.id}`,type:"conversion",productName:t.productTitle||E(t.productUrl),productUrl:t.productUrl,status:"purchased",amount:t.productPrice?parseFloat(t.productPrice):void 0,timestamp:t.timestamp,userAgent:t.userAgent,referrer:t.referrer,ip:t.ipAddress})),...x.map(t=>{const i=typeof t.eventData=="string"?JSON.parse(t.eventData):t.eventData;let h="click",j="browsed",f="Product",K;switch(t.eventType){case"add_to_cart":h="add_to_cart",j="added_to_cart",f=i.product_name||"Product";break;case"purchase":h="purchase",j="purchased",f=`Order ${i.order_id||"Unknown"}`,K=i.total;break;case"page_view":h="page_view",j="viewed",f="Page View";break;case"product_view":h="product_view",j="viewed",f=i.product_name||"Product";break;default:h="click",j="browsed"}return{id:`event-${t.id}`,type:h,productName:f,productUrl:t.url||"",status:j,amount:K,timestamp:t.timestamp,userAgent:t.userAgent,referrer:t.referrer,ip:t.ipAddress,eventData:i,platform:t.platform,sessionId:t.sessionId}})];z.sort((t,i)=>new Date(i.timestamp).getTime()-new Date(t.timestamp).getTime()),Z(z);const V=D.length,N=A.length+x.filter(t=>t.eventType==="purchase").length,$=x.filter(t=>t.eventType==="add_to_cart").length,ie=x.filter(t=>t.eventType==="page_view").length,ce=x.filter(t=>t.eventType==="product_view").length,q=A.reduce((t,i)=>t+(i.amount||0),0)+x.filter(t=>t.eventType==="purchase").reduce((t,i)=>{const h=typeof i.eventData=="string"?JSON.parse(i.eventData):i.eventData;return t+(h.total||0)},0),le=V>0?N/V*100:0,ne=$>0?N/$*100:0,de=N>0?q/N:0,oe=new Set([...D.map(t=>t.sessionId).filter(Boolean),...A.map(t=>t.sessionId).filter(Boolean),...x.map(t=>t.sessionId).filter(Boolean)]).size;te({totalClicks:V,totalPurchases:N,totalRevenue:q,conversionRate:le,totalAddToCart:$,totalPageViews:ie,totalProductViews:ce,cartToPurchaseRate:ne,averageOrderValue:de,totalSessions:oe})}catch(r){console.error("Error fetching activity:",r),I("Failed to load activity data. Please try again.")}finally{F(!1),O(!1)}},L=()=>{U(!0)},E=s=>{try{const p=new URL(s).pathname.split("/").filter(Boolean);return p[p.length-1]||"Product"}catch{return"Product"}},se=s=>{switch(s){case"purchased":return e.jsx(g,{className:"bg-green-500/20 text-green-300 border-0",children:"Purchased"});case"browsed":return e.jsx(g,{className:"bg-blue-500/20 text-blue-300 border-0",children:"Browsed"});case"abandoned":return e.jsx(g,{className:"bg-red-500/20 text-red-300 border-0",children:"Abandoned"});case"added_to_cart":return e.jsx(g,{className:"bg-orange-500/20 text-orange-300 border-0",children:"Added to Cart"});case"viewed":return e.jsx(g,{className:"bg-purple-500/20 text-purple-300 border-0",children:"Viewed"});default:return e.jsx(g,{variant:"outline",className:"text-white border-white/30",children:s})}},ae=s=>{switch(s){case"click":return e.jsx(m,{className:"h-4 w-4 text-blue-600"});case"purchase":case"conversion":return e.jsx(C,{className:"h-4 w-4 text-green-600"});case"add_to_cart":return e.jsx(C,{className:"h-4 w-4 text-orange-600"});case"page_view":return e.jsx(m,{className:"h-4 w-4 text-purple-600"});case"product_view":return e.jsx(m,{className:"h-4 w-4 text-indigo-600"});default:return e.jsx(m,{className:"h-4 w-4"})}},re=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),J=Y.filter(s=>o==="clicks"?s.type==="click":o==="purchases"?s.type==="purchase":o==="add_to_cart"?s.type==="add_to_cart":o==="page_views"?s.type==="page_view":!0);return ee&&!P?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((s,r)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},r))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):B?e.jsxs("div",{className:"space-y-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[e.jsx(he,{className:"h-5 w-5"}),e.jsx("p",{children:B})]}),e.jsxs(w,{onClick:L,className:"bg-red-500 hover:bg-red-600 text-white",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Refresh Data"]})]}):e.jsxs("div",{className:"space-y-6 text-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-white",children:"Total Clicks"}),e.jsx(m,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.totalClicks.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Product page visits"})]})]}),e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-white",children:"Add to Cart"}),e.jsx(C,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.totalAddToCart.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Cart additions"})]})]}),e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-white",children:"Total Purchases"}),e.jsx(C,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.totalPurchases.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Successful conversions"})]})]}),e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-white",children:"Total Revenue"}),e.jsx(M,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",a.totalRevenue.toLocaleString()]}),e.jsx("p",{className:"text-xs text-white/80",children:"Revenue from purchases"})]})]}),e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-white",children:"Avg Order Value"}),e.jsx(M,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",a.averageOrderValue.toFixed(2)]}),e.jsx("p",{className:"text-xs text-white/80",children:"Average per order"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-white",children:"Page Views"}),e.jsx(m,{className:"h-4 w-4 text-purple-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.totalPageViews.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Page visits"})]})]}),e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-white",children:"Product Views"}),e.jsx(m,{className:"h-4 w-4 text-indigo-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.totalProductViews.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Product page visits"})]})]}),e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-white",children:"Conversion Rate"}),e.jsx(Q,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[a.conversionRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-white/80",children:"Click to purchase"})]})]}),e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-white",children:"Cart Conversion"}),e.jsx(Q,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[a.cartToPurchaseRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-white/80",children:"Cart to purchase"})]})]}),e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-white",children:"Total Sessions"}),e.jsx(W,{className:"h-4 w-4 text-cyan-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.totalSessions.toLocaleString()}),e.jsx("p",{className:"text-xs text-white/80",children:"Unique sessions"})]})]})]}),e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsx(l,{children:e.jsx(n,{className:"text-white",children:"Key Insights"})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:[a.totalPurchases>0?a.conversionRate.toFixed(1):"0","%"]}),e.jsx("div",{className:"text-sm text-white/80",children:"Click to Purchase Rate"}),e.jsxs("div",{className:"text-xs text-white/60 mt-1",children:[a.totalClicks," clicks → ",a.totalPurchases," purchases"]})]}),e.jsxs("div",{className:"text-center p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-400",children:[a.totalAddToCart>0?a.cartToPurchaseRate.toFixed(1):"0","%"]}),e.jsx("div",{className:"text-sm text-white/80",children:"Cart to Purchase Rate"}),e.jsxs("div",{className:"text-xs text-white/60 mt-1",children:[a.totalAddToCart," cart additions → ",a.totalPurchases," purchases"]})]}),e.jsxs("div",{className:"text-center p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-400",children:["$",a.averageOrderValue.toFixed(2)]}),e.jsx("div",{className:"text-sm text-white/80",children:"Average Order Value"}),e.jsxs("div",{className:"text-xs text-white/60 mt-1",children:["Total: $",a.totalRevenue.toFixed(2)," / ",a.totalPurchases," orders"]})]})]})})]}),e.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[e.jsx(w,{onClick:()=>b("all"),className:`${o==="all"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"All Activity"}),e.jsx(w,{onClick:()=>b("clicks"),className:`${o==="clicks"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"Clicks Only"}),e.jsx(w,{onClick:()=>b("add_to_cart"),className:`${o==="add_to_cart"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"Add to Cart"}),e.jsx(w,{onClick:()=>b("purchases"),className:`${o==="purchases"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"Purchases Only"}),e.jsx(w,{onClick:()=>b("page_views"),className:`${o==="page_views"?"bg-white text-black":"bg-white/10 text-white hover:bg-white/20"} rounded-full`,children:"Page Views"}),e.jsxs(w,{onClick:L,disabled:P,className:"bg-white/10 text-white hover:bg-white/20 rounded-full ml-auto",children:[e.jsx(G,{className:`h-4 w-4 mr-2 ${P?"animate-spin":""}`}),P?"Refreshing...":"Refresh"]})]}),e.jsxs(c,{className:"border-white/10 bg-white/5 text-white",children:[e.jsx(l,{children:e.jsx(n,{className:"text-white",children:"Recent Activity"})}),e.jsx(d,{children:J.length===0?e.jsx("div",{className:"text-center py-8 text-white/70",children:e.jsx("p",{children:"No activity found for the selected filter."})}):e.jsxs(xe,{children:[e.jsx(me,{children:e.jsxs(X,{className:"border-white/20 hover:bg-white/5",children:[e.jsx(v,{className:"text-white border-b border-white/20 pb-3",children:"Type"}),e.jsx(v,{className:"text-white border-b border-white/20 pb-3",children:"Product"}),e.jsx(v,{className:"text-white border-b border-white/20 pb-3",children:"Status"}),e.jsx(v,{className:"text-white border-b border-white/20 pb-3",children:"Amount"}),e.jsx(v,{className:"text-white border-b border-white/20 pb-3",children:"Date"})]})}),e.jsx(ue,{children:J.slice(0,20).map((s,r)=>e.jsxs(X,{className:"border-b border-white/10 hover:bg-white/5 transition-colors duration-200",children:[e.jsx(y,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[ae(s.type),e.jsx("span",{className:"capitalize text-white",children:s.type})]})}),e.jsx(y,{className:"py-4",children:e.jsx("div",{className:"max-w-xs truncate",children:e.jsx("a",{href:s.productUrl,target:"_blank",rel:"noopener noreferrer",className:"text-white hover:underline transition-colors duration-200",children:s.productName})})}),e.jsx(y,{className:"py-4",children:se(s.status)}),e.jsx(y,{className:"py-4",children:e.jsx("span",{className:"text-white",children:s.amount?`$${s.amount.toFixed(2)}`:"-"})}),e.jsx(y,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3 text-white/60"}),e.jsx("span",{className:"text-white/80",children:re(s.timestamp)})]})})]},s.id))})]})})]})]})}export{ke as default};
